# 更新日志

## 1.0.8 (2026-02-N忘了)

###
### 新增功能
- **自动撤回**：一定时间后自动撤回
- **点歌隔离**：在该用户点歌后其余用户无法使用该用户的搜索结果点歌

### 更新鸣谢
- 感谢 [NanoRocky](https://github.com/NanoRocky) 更新此版本

## 1.0.7 (2026-02-24)

### 修复
- **修复链接组合异常**：优化 API URL 拼接逻辑，确保地址格式正确
- **修复音频处理线程阻塞问题**：将音频解码和导出操作移至线程池执行，避免阻塞主事件循环
- **修复定期清理阻塞问题**：文件清理操作改为在线程池中执行


### 更新鸣谢
- 感谢 [NanoRocky](https://github.com/NanoRocky) 提供的PR与功能添加与代码优化

## 1.0.6 (2026-02-24)

### 改进
- **文件大小显示优化**：下载提示和日志中的文件大小统一显示为 MB 格式
- **配置读取健壮性**：`get_max_file_size()` 方法添加异常处理，支持 float 类型，防止配置错误导致插件崩溃

## 1.0.5 (2026-02-21)

### 新增功能
- **音乐卡片功能**：支持通过 `oiapi.net` 签名服务发送精美的音乐卡片消息（默认关闭）
- **快捷点歌指令**：新增直接指定音源的点歌命令
  - `网易点歌 <歌名>` - 在网易云音乐中搜索并播放第一首
  - `腾讯点歌 <歌名>` / `QQ点歌 <歌名>` - 在QQ音乐中搜索并播放第一首
  - `酷狗点歌 <歌名>` - 在酷狗音乐中搜索并播放第一首
  - `酷我点歌 <歌名>` - 在酷我音乐中搜索并播放第一首
- **点歌帮助指令**：新增 `点歌指令` / `点歌帮助` / `点歌说明` 命令，显示所有可用指令列表
- **API 配置对象化**：将 API 相关配置整合为 `api_config` 对象，支持预设 API 选择和自定义 API

### 改进
- **音乐卡片默认关闭**：`use_music_card` 默认改为 `false`，避免未配置签名服务时出错
- **URL 强制 HTTPS**：音乐卡片相关 URL 自动转换为 HTTPS，提高安全性
- **音源别名扩展**：切换音源命令支持更多别名，如 `切换腾讯音乐`、`切换QQMusic` 等
- **哔哩哔哩音源支持**：音乐卡片支持 bilibili 音源（如 API 支持）

### 更新鸣谢
- 感谢 [NanoRocky](https://github.com/NanoRocky) 提供的PR与功能添加与代码优化

## 1.0.4 (2026-02-20)

### 改进
- API 配置改为支持三种类型：
  - **1. Node API**（默认）：标准 MetingAPI，地址不带后缀，如 `https://api.example.com/meting`
  - **2. PHP API**：PHP 版本 MetingAPI，使用 `keyword` 参数
  - **3. 自定义参数**：在 MetingAPI 地址填写完整模板，如 `https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&r=:r`
- 配置项名称改回 `api_url`，更简洁直观
- 新增 `api_type` 配置项用于选择 API 类型

### 更新鸣谢
- 感谢 [NanoRocky](https://github.com/NanoRocky) 提供的PR与功能添加与代码优化

## 1.0.3 (2026-02-20)

### 改进
- API 配置改为模板格式，支持自定义占位符 `:server`、`:type`、`:id`、`:r`，最大限度兼容各种 MetingAPI
- 搜索命令改为 `搜歌 <关键词>`，更直观
- 播放命令改为 `点歌 x`（必须带空格），避免与搜索命令冲突

### 移除
- 移除 `_validate_api_url` 方法，统一使用 `_validate_url` 进行 URL 安全验证

## 1.0.0 (2026-02-16)

### 功能
- 基于 MetingAPI 的点歌插件
- 支持自定义 MetingAPI 模板，最大限度兼容各种 API 格式
- 支持QQ音乐、网易云、酷狗、酷我音源
- 支持切换当前会话的音源
- `搜歌 <关键词>` 搜索歌曲
- `点歌 x`（带空格）播放第x首搜索结果
- 歌曲自动分段为语音消息发送

### 安全性
- URL 安全校验，防止 SSRF 攻击
- 文件头魔数检测，验证音频文件有效性
- 临时文件使用唯一命名空间前缀

### 并发安全
- 会话数据封装为 SessionData 类，避免裸 dict 外泄
- 会话清理操作在锁保护下进行
- 临时文件追踪和清理机制